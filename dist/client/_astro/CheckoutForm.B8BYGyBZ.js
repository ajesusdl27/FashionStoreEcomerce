import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.WFquGv8Z.js";import{u as j}from"./index.Ctr3S7GU.js";import{$ as P,a as S}from"./cart.BgO2WpaW.js";const F=50,I=4.99,T={customerName:"",customerEmail:"",customerPhone:"",shippingAddress:"",shippingCity:"",shippingPostalCode:""};function c(o){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(o)}function z({userData:o}){const n=j(P),u=j(S),[t,x]=d.useState(1),[r,h]=d.useState(T),[p,g]=d.useState(!1),[f,a]=d.useState(null),m=u>=F?0:I,b=u+m;d.useEffect(()=>{o&&h(s=>({...s,customerName:o.name||s.customerName,customerEmail:o.email||s.customerEmail,customerPhone:o.phone||s.customerPhone}))},[o]),d.useEffect(()=>{n.length===0&&typeof window<"u"&&(window.location.href="/carrito")},[n]);const i=(s,l)=>{h(E=>({...E,[s]:l})),a(null)},N=s=>{switch(s){case 1:return r.customerName.trim()?!r.customerEmail.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.customerEmail)?(a("Introduce un email v√°lido"),!1):!0:(a("El nombre es obligatorio"),!1);case 2:return r.shippingAddress.trim()?r.shippingCity.trim()?!r.shippingPostalCode.trim()||!/^\d{5}$/.test(r.shippingPostalCode)?(a("Introduce un c√≥digo postal v√°lido (5 d√≠gitos)"),!1):!0:(a("La ciudad es obligatoria"),!1):(a("La direcci√≥n es obligatoria"),!1);default:return!0}},y=()=>{N(t)&&x(s=>Math.min(s+1,3))},v=()=>{x(s=>Math.max(s-1,1)),a(null)},w=async()=>{g(!0),a(null);try{const s=await fetch("/api/checkout/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:n,...r})}),l=await s.json();if(!s.ok)throw new Error(l.error||"Error al procesar el pago");l.url&&(window.location.href=l.url)}catch(s){a(s instanceof Error?s.message:"Error desconocido"),g(!1)}},C=e.jsx("div",{className:"flex items-center justify-center mb-8",children:[1,2,3].map((s,l)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${s===t?"bg-primary text-background scale-110":s<t?"bg-emerald-500 text-white":"bg-muted text-muted-foreground"}`,children:s<t?"‚úì":s}),l<2&&e.jsx("div",{className:`w-16 md:w-24 h-1 mx-2 transition-all ${s<t?"bg-emerald-500":"bg-muted"}`})]},s))}),k=["Datos personales","Direcci√≥n de env√≠o","Resumen y pago"];return e.jsxs("div",{className:"lg:grid lg:grid-cols-5 lg:gap-12",children:[e.jsxs("div",{className:"lg:col-span-3",children:[C,e.jsxs("p",{className:"text-center text-muted-foreground mb-8",children:["Paso ",t," de 3: ",e.jsx("span",{className:"text-foreground font-medium",children:k[t-1]})]}),f&&e.jsx("div",{className:"bg-accent/10 border border-accent text-accent px-4 py-3 rounded-lg mb-6 animate-shake",children:f}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 md:p-8",children:[t===1&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium mb-2",children:"Nombre completo *"}),e.jsx("input",{type:"text",id:"name",value:r.customerName,onChange:s=>i("customerName",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"Tu nombre completo",autoComplete:"name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-2",children:"Email *"}),e.jsx("input",{type:"email",id:"email",value:r.customerEmail,onChange:s=>i("customerEmail",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"tu@email.com",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm font-medium mb-2",children:["Tel√©fono ",e.jsx("span",{className:"text-muted-foreground",children:"(opcional)"})]}),e.jsx("input",{type:"tel",id:"phone",value:r.customerPhone,onChange:s=>i("customerPhone",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"612 345 678",autoComplete:"tel"})]})]}),t===2&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium mb-2",children:"Direcci√≥n *"}),e.jsx("input",{type:"text",id:"address",value:r.shippingAddress,onChange:s=>i("shippingAddress",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"Calle, n√∫mero, piso...",autoComplete:"street-address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium mb-2",children:"Ciudad *"}),e.jsx("input",{type:"text",id:"city",value:r.shippingCity,onChange:s=>i("shippingCity",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"Madrid",autoComplete:"address-level2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postal",className:"block text-sm font-medium mb-2",children:"C√≥digo postal *"}),e.jsx("input",{type:"text",id:"postal",value:r.shippingPostalCode,onChange:s=>i("shippingPostalCode",s.target.value),className:"w-full px-4 py-3 bg-background border border-border rounded-lg focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",placeholder:"28001",maxLength:5,autoComplete:"postal-code"})]})]})]}),t===3&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Datos de contacto"}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Nombre:"})," ",r.customerName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",r.customerEmail]}),r.customerPhone&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tel√©fono:"})," ",r.customerPhone]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Direcci√≥n de env√≠o"}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 text-sm",children:[e.jsx("p",{children:r.shippingAddress}),e.jsxs("p",{children:[r.shippingPostalCode," ",r.shippingCity]}),e.jsx("p",{children:"Espa√±a"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-heading text-lg font-semibold mb-4",children:["Productos (",n.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-[200px] overflow-y-auto",children:n.map(s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("img",{src:s.imageUrl,alt:s.productName,className:"w-12 h-12 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.productName}),e.jsxs("p",{className:"text-muted-foreground",children:["Talla ",s.size," √ó ",s.quantity]})]}),e.jsx("p",{className:"font-medium",children:c(s.price*s.quantity)})]},s.id))})]})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[t>1&&e.jsx("button",{type:"button",onClick:v,disabled:p,className:"flex-1 py-3 px-6 border border-border rounded-lg font-medium hover:bg-muted transition-colors disabled:opacity-50",children:"Atr√°s"}),t<3?e.jsx("button",{type:"button",onClick:y,className:"flex-1 py-3 px-6 bg-primary text-background rounded-lg font-bold hover:bg-primary/90 transition-colors",children:"Continuar"}):e.jsx("button",{type:"button",onClick:w,disabled:p,className:"flex-1 py-3 px-6 bg-primary text-background rounded-lg font-bold hover:bg-primary/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Procesando..."]}):e.jsxs(e.Fragment,{children:["üîí Pagar ",c(b)]})})]})]})]}),e.jsx("div",{className:"lg:col-span-2 mt-8 lg:mt-0",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 sticky top-24",children:[e.jsx("h2",{className:"font-heading text-xl font-semibold mb-6",children:"Resumen del pedido"}),e.jsx("div",{className:"space-y-4 mb-6 max-h-[300px] overflow-y-auto",children:n.map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:[e.jsx("img",{src:s.imageUrl,alt:s.productName,className:"w-full h-full object-cover"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-muted-foreground text-background text-xs rounded-full flex items-center justify-center",children:s.quantity})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.productName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Talla: ",s.size]}),e.jsx("p",{className:"font-medium text-sm mt-1",children:c(s.price*s.quantity)})]})]},s.id))}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{children:c(u)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Env√≠o"}),e.jsx("span",{className:m===0?"text-emerald-400 font-medium":"",children:m===0?"GRATIS":c(m)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-border text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:c(b)})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Pago seguro con Stripe"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Reserva de stock por 30 minutos"]})]})]})})]})}export{z as default};
