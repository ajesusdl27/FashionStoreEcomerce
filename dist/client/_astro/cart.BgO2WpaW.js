let a=[],d=0;const o=4;let v=0,I=e=>{let l=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(i){return n.lc=l.push(i),()=>{for(let r=d+o;r<a.length;)a[r]===i?a.splice(r,o):r+=o;let t=l.indexOf(i);~t&&(l.splice(t,1),--n.lc||n.off())}},notify(i,t){v++;let r=!a.length;for(let s of l)a.push(s,n.value,i,t);if(r){for(d=0;d<a.length;d+=o)a[d](a[d+1],a[d+2],a[d+3]);a.length=0}},off(){},set(i){let t=n.value;t!==i&&(n.value=i,n.notify(t))},subscribe(i){let t=n.listen(i);return i(n.value),t},value:e};return n};const x=5,p=6,g=10;let N=(e,l,n,i)=>(e.events=e.events||{},e.events[n+g]||(e.events[n+g]=i(t=>{e.events[n].reduceRight((r,s)=>(s(r),r),{shared:{},...t})})),e.events[n]=e.events[n]||[],e.events[n].push(l),()=>{let t=e.events[n],r=t.indexOf(l);t.splice(r,1),t.length||(delete e.events[n],e.events[n+g](),delete e.events[n+g])}),S=1e3,U=(e,l)=>N(e,i=>{let t=l(i);t&&e.events[p].push(t)},x,i=>{let t=e.listen;e.listen=(...s)=>(!e.lc&&!e.active&&(e.active=!0,i()),t(...s));let r=e.off;return e.events[p]=[],e.off=()=>{r(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let s of e.events[p])s();e.events[p]=[]}},S)},()=>{e.listen=t,e.off=r}}),_=(e,l,n)=>{Array.isArray(e)||(e=[e]);let i,t,r=()=>{if(t===v)return;t=v;let c=e.map(u=>u.get());if(!i||c.some((u,h)=>u!==i[h])){i=c;let u=l(...c);u&&u.then&&u.t?u.then(h=>{i===c&&s.set(h)}):(s.set(u),t=v)}},s=I(void 0),m=s.get;s.get=()=>(r(),m());let O=r;return U(s,()=>{let c=e.map(u=>u.listen(O));return r(),()=>{for(let u of c)u()}}),s},E=(e,l)=>_(e,l);const T="fashionstore_cart";function C(){if(typeof window>"u")return[];try{const e=localStorage.getItem(T);return e?JSON.parse(e):[]}catch{return[]}}function R(e){typeof window>"u"||localStorage.setItem(T,JSON.stringify(e))}const f=I(C());f.subscribe(e=>{R(e)});const M=E(f,e=>e.reduce((l,n)=>l+n.quantity,0)),L=E(f,e=>e.reduce((l,n)=>l+n.price*n.quantity,0));function w(e,l=1){const n=f.get(),i=n.findIndex(t=>t.productId===e.productId&&t.variantId===e.variantId);if(i>=0){const t=[...n];t[i]={...t[i],quantity:t[i].quantity+l},f.set(t)}else{const t={...e,id:`${e.productId}-${e.variantId}`,quantity:l};f.set([...n,t])}}function A(e){const l=f.get();f.set(l.filter(n=>n.id!==e))}function y(e,l){if(l<=0){A(e);return}const i=f.get().map(t=>t.id===e?{...t,quantity:l}:t);f.set(i)}function Q(){f.set([])}export{f as $,L as a,w as b,M as c,Q as d,A as r,y as u};
