import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.WFquGv8Z.js";import{s as k}from"./supabase.CvUDO22r.js";function O({initialImages:b=[],onImagesChange:h,bucket:v="products",folder:L="images",inputName:j,inputId:C}){const[d,u]=g.useState(b.map(t=>({url:t,uploading:!1}))),[f,x]=g.useState(!1),[M,D]=g.useState(b),I=async t=>typeof window>"u"?new Blob:new Promise((r,a)=>{const s=new Image;s.onload=()=>{const o=document.createElement("canvas"),n=1200,m=1200;let{width:i,height:l}=s;if(i>n||l>m){const p=Math.min(n/i,m/l);i=Math.round(i*p),l=Math.round(l*p)}o.width=i,o.height=l;const c=o.getContext("2d");if(!c){a(new Error("Could not get canvas context"));return}c.drawImage(s,0,0,i,l),o.toBlob(p=>{p?r(p):a(new Error("Could not convert to WebP"))},"image/webp",.85)},s.onerror=()=>a(new Error("Could not load image")),s.src=URL.createObjectURL(t)}),E=()=>{const t=Date.now(),r=Math.random().toString(36).substring(2,8);return`${L}/${t}-${r}.webp`},W=async t=>{const r=await I(t),a=E(),{data:s,error:o}=await k.storage.from(v).upload(a,r,{contentType:"image/webp",cacheControl:"31536000"});if(o)throw new Error(o.message);const{data:{publicUrl:n}}=k.storage.from(v).getPublicUrl(s.path);return n},w=async t=>{const a=Array.from(t).filter(n=>n.type.startsWith("image/"));if(a.length===0)return;const s=a.map(()=>({url:"",uploading:!0}));u(n=>[...n,...s]);const o=d.length;for(let n=0;n<a.length;n++){const m=a[n];if(m)try{const i=await W(m);u(l=>{const c=[...l];return c[o+n]&&(c[o+n]={url:i,uploading:!1}),c})}catch(i){u(l=>{const c=[...l];return c[o+n]&&(c[o+n]={url:"",uploading:!1,error:i.message}),c})}}},y=g.useCallback(t=>{const r=t.filter(a=>a.url&&!a.uploading).map(a=>a.url);D(r),h&&h(r)},[h]);g.useEffect(()=>{y(d)},[d,y]);const B=t=>{const r=d.filter((a,s)=>s!==t);u(r)},N=(t,r)=>{if(r<0||r>=d.length)return;const a=[...d],[s]=a.splice(t,1);a.splice(r,0,s),u(a)},P=t=>{t.preventDefault(),x(!0)},S=t=>{t.preventDefault(),x(!1)},U=t=>{t.preventDefault(),x(!1),t.dataTransfer.files.length>0&&w(t.dataTransfer.files)};return e.jsxs("div",{className:"space-y-4",children:[j&&e.jsx("input",{type:"hidden",name:j,id:C,value:JSON.stringify(M)}),e.jsxs("div",{onDragOver:P,onDragLeave:S,onDrop:U,className:`
          border-2 border-dashed rounded-xl p-8 text-center transition-all cursor-pointer
          ${f?"border-primary bg-primary/10":"border-border hover:border-primary/50 hover:bg-muted/50"}
        `,onClick:()=>document.getElementById("file-input")?.click(),children:[e.jsx("input",{type:"file",id:"file-input",multiple:!0,accept:"image/*",className:"hidden",onChange:t=>t.target.files&&w(t.target.files)}),e.jsx("svg",{className:`w-12 h-12 mx-auto mb-4 ${f?"text-primary":"text-muted-foreground"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-muted-foreground",children:f?e.jsx("span",{className:"text-primary font-medium",children:"Suelta las imágenes aquí"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary font-medium",children:"Click para seleccionar"})," ","o arrastra imágenes aquí"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Se convertirán automáticamente a WebP • Máx 1200px"})]}),d.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:d.map((t,r)=>e.jsx("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-border bg-muted",children:t.uploading?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):t.error?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-accent/20 p-2",children:e.jsx("p",{className:"text-xs text-accent text-center",children:t.error})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.url,alt:`Imagen ${r+1}`,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[r>0&&e.jsx("button",{type:"button",onClick:()=>N(r,r-1),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Mover izquierda",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{type:"button",onClick:()=>B(r),className:"p-2 bg-accent/80 rounded-lg hover:bg-accent transition-colors",title:"Eliminar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r<d.length-1&&e.jsx("button",{type:"button",onClick:()=>N(r,r+1),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Mover derecha",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),r===0&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-primary text-primary-foreground text-xs rounded font-medium",children:"Principal"})]})},r))})]})}export{O as default};
